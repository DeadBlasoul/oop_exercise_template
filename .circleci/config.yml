version: 2

workflows:
    version: 2
    build-and-test:
        jobs:
            - prepare
            - build:
                requires:
                    - prepare
            - test:
                requires:
                    - build

jobs:
    prepare:
        docker:
            - image: "gcc:8.2"
        steps:
            - checkout
            - run:
                name: Installing SUDO
                command: 'apt-get update && apt-get install -y sudo && rm -rf /var/lib/apt/lists/*'
            - run:
                name: Installing GCC
                command: 'apt-get update && apt-get install -y gcc g++'
            - run:
                name: Install CMAKE
                command: 'apt-get update && sudo apt-get install -y cmake'
            - run:
                name: Install GIT
                command: 'apt-get update && sudo apt-get install -y git'
    build:
        docker:
            - image: "gcc:8.2"
        steps:
            - checkout
            - run:
                name: Creating Build Files
                command: 'cmake -H. -Bbuild'
            - run:
                name: Creating Binary Files
                command: 'cmake --build build'
    test:
        docker:
            - image: "gcc:8.2"
        steps:
            - checkout
            - run: ctest