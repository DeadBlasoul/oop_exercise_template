version: 2

workflows:
    version: 2
    build-and-test:
        jobs:
            - build-and-test
jobs:
    build-and-test:
        docker:
            - image: "ubuntu:18.04"
        steps:
            - restore_cache:
                keys:
                    - source-v1-{{ .Branch }}-{{ .Revision }}
                    - source-v1-{{ .Branch }}-
                    - source-v1-
            
            - checkout
            - run:
                name: Install Dependencies
                command: 'apt-get update && sudo apt-get install -y $(cat dependencies.txt)'

            - save_cache:
                key: source-v1-{{ .Branch }}-{{ .Revision }}
                paths:
                    - ".git"

            - run:
                name: Creating Build Files
                command: 'cmake -H. -Bbuild'
            - run:
                name: Creating Binary Files
                command: 'cmake --build build'
            - run:
                name: Testing
                command: 'cd build; ctest'